version: 1
project: "Dash"
description: "Self-hosted, grid-based homelab dashboard with tabs, design mode, theming, and RBAC."

phases:
  - id: phase-1-core
    name: "Phase 1 – Core repo, app shells, auth skeleton"
    tasks:
      - id: p1-repo-structure
        title: "Create repo and base structure"
        kind: "devops"
        dependsOn: []
        details:
          - "Initialize git repo 'dash'."
          - "Choose monorepo tooling (Nx or npm workspaces)."
          - "Create apps: 'dash-frontend' (Angular), 'dash-backend' (Node/Bun)."
        outputs:
          - "Root package.json with workspace references."
          - "CI placeholder workflow."

      - id: p1-frontend-bootstrap
        title: "Bootstrap Angular app shell"
        kind: "frontend"
        dependsOn: [p1-repo-structure]
        details:
          - "Generate latest Angular app with standalone APIs and routing."
          - "Create base layout (top bar + content outlet)."
          - "Add initial route '/boards'."
        outputs:
          - "Running Angular shell with placeholder boards page."

      - id: p1-backend-bootstrap
        title: "Bootstrap backend API"
        kind: "backend"
        dependsOn: [p1-repo-structure]
        details:
          - "Create Node/Bun app with chosen framework (Express/Nest/Hono)."
          - "Add logging, error handling, config management."
          - "Expose '/health' endpoint."
        outputs:
          - "Backend server with health check."

      - id: p1-db-schema
        title: "Define initial DB schema and migrations"
        kind: "backend"
        dependsOn: [p1-backend-bootstrap]
        details:
          - "Pick DB (SQLite or Postgres)."
          - "Define tables: users, roles, boards, tabs, zones, cards, themes, assets."
          - "Set up migrations (Prisma/TypeORM/Kysely)."
        outputs:
          - "Initial migration files."
          - "DB connection module."

      - id: p1-auth-jwt
        title: "Implement JWT auth (login/register/refresh)"
        kind: "backend"
        dependsOn: [p1-db-schema]
        details:
          - "User registration with password hashing."
          - "Login issuing access + refresh tokens."
          - "Refresh endpoint and auth middleware."
        outputs:
          - "POST /auth/register, /auth/login, /auth/refresh."
          - "Auth guard middleware."

      - id: p1-frontend-auth
        title: "Wire up frontend auth"
        kind: "frontend"
        dependsOn: [p1-frontend-bootstrap, p1-auth-jwt]
        details:
          - "Create AuthService (login, logout, refresh)."
          - "Token storage (memory + localStorage)."
          - "AuthGuard to protect routes."
          - "Simple login page."
        outputs:
          - "User can log in and access protected area."

  - id: phase-2-boards-tabs-zones-cards
    name: "Phase 2 – Boards, tabs, zones, cards, grid layout"
    tasks:
      - id: p2-api-board-model
        title: "Board model and CRUD API"
        kind: "backend"
        dependsOn: [p1-auth-jwt]
        details:
          - "Define Board entity with themeId, isLocked and owner."
          - "Implement GET/POST/PATCH/DELETE /api/boards."
          - "Scope queries to current user for now."
        outputs:
          - "Board persistence and basic CRUD."

      - id: p2-api-tab-model
        title: "Tab model and API under boards"
        kind: "backend"
        dependsOn: [p2-api-board-model]
        details:
          - "Define Tab entity with boardId, name, slug, order."
          - "Create endpoints: list/create/update/delete tabs for a board."
          - "Endpoint examples: /api/boards/:boardId/tabs, /api/tabs/:tabId."
        outputs:
          - "Tabs persisted and tied to boards with ordering."

      - id: p2-api-zones-cards-model
        title: "Zone and card model with layout and style"
        kind: "backend"
        dependsOn: [p2-api-tab-model]
        details:
          - "Define Zone with tabId, name, order."
          - "Define Card with zoneId, layout (x,y,w,h) and style fields."
          - "Implement CRUD for zones and cards."
          - "Add endpoints for updating layout and style separately."
        outputs:
          - "Zones and cards persisted under tabs."

      - id: p2-frontend-boards-list
        title: "Boards list UI and navigation"
        kind: "frontend"
        dependsOn: [p1-frontend-auth, p2-api-board-model]
        details:
          - "Create boards list page for current user."
          - "Support create/delete/rename boards."
          - "Route pattern: /boards/:boardSlug (landing on default tab)."
        outputs:
          - "User can manage and open boards in Dash."

      - id: p2-frontend-board-tabs-ui
        title: "Tab bar UI inside board view"
        kind: "frontend"
        dependsOn: [p2-frontend-boards-list, p2-api-tab-model]
        details:
          - "Extend board view route to /boards/:boardSlug/:tabSlug."
          - "Create tab bar component listing tabs for current board."
          - "Allow add/rename/reorder/delete tabs."
          - "Persist tab ordering via API."
        outputs:
          - "User can create and switch between tabs in a board."

      - id: p2-frontend-board-grid
        title: "Grid layout per tab with drag-and-drop"
        kind: "frontend"
        dependsOn: [p2-board-layout-service, p2-frontend-board-tabs-ui]
        details:
          - "Create DashBoardViewComponent that loads board + current tab."
          - "Render zones (optional) and cards for active tab."
          - "Use CSS Grid + CDK DragDrop for per-tab card layout."
          - "On drag end, compute new (x,y) and persist via layout API."
        outputs:
          - "Each tab has its own draggable grid of cards."

      - id: p2-board-layout-service
        title: "BoardLayoutService for layout operations"
        kind: "fullstack"
        dependsOn: [p2-api-zones-cards-model]
        details:
          - "Backend: service to move/resize cards safely (snap to grid, prevent overlap if needed)."
          - "Frontend: service wrapper for calling layout endpoints."
        outputs:
          - "Layout operations abstracted into a dedicated service."

      - id: p2-card-component
        title: "DashCardComponent shell"
        kind: "frontend"
        dependsOn: [p2-frontend-board-grid]
        details:
          - "Create card shell component taking DashCard as input."
          - "Apply grid positioning via CardLayout."
          - "Render title, subtitle, icon placeholder."
        outputs:
          - "Basic visible cards on each tab."

      - id: p2-locking
        title: "Board/tab/card locking behavior"
        kind: "fullstack"
        dependsOn: [p2-card-component]
        details:
          - "Use board.isLocked to disable all layout changes across tabs."
          - "Use card.layout.locked for per-card lock."
          - "Endpoints to toggle board lock and card lock."
          - "Disable drag/resize in Angular when locked or user lacks permissions."
        outputs:
          - "Locking implemented for boards and cards (tabs inherit board lock)."

  - id: phase-3-theming-and-styles
    name: "Phase 3 – Base16/Base24 theming, style modes, backgrounds"
    tasks:
      - id: p3-theme-entity
        title: "Theme entity, storage, and seeding"
        kind: "backend"
        dependsOn: [p1-db-schema]
        details:
          - "Create Theme table with baseScheme, tokens JSON, styleMode, background config."
          - "Seed some Base16 themes."
          - "Implement GET /api/themes and GET /api/themes/:id."
        outputs:
          - "Persistent themes and read API."

      - id: p3-theme-service-frontend
        title: "ThemeService and CSS variables"
        kind: "frontend"
        dependsOn: [p3-theme-entity, p2-frontend-board-grid]
        details:
          - "Load board.themeId and fetch theme."
          - "Apply base16/base24 tokens to :root or board container as CSS variables."
          - "Support styleMode (glass, neo, minimal, clay)."
        outputs:
          - "Boards/tabs visually themed via CSS variables."

      - id: p3-background-modes
        title: "Background modes (theme, color, upload, Pexels)"
        kind: "fullstack"
        dependsOn: [p3-theme-entity]
        details:
          - "Backend: file upload endpoint for backgrounds."
          - "Backend: Pexels proxy/search endpoint."
          - "Frontend: Theme background editor with options: theme default, color, image upload, Pexels."
          - "Apply background at board level (shared across tabs for now)."
        outputs:
          - "Configurable board backgrounds."

  - id: phase-4-design-mode-and-styling
    name: "Phase 4 – Design Mode, per-card styling, color picker"
    tasks:
      - id: p4-design-mode-service
        title: "Global DesignModeService"
        kind: "frontend"
        dependsOn: [p2-frontend-board-grid]
        details:
          - "Implement signal-based DesignModeService (on/off)."
          - "Board-level toggle button gated by permissions."
          - "Persist 'last design mode state' in memory only (no DB needed)."
        outputs:
          - "Design mode toggle available on boards."

      - id: p4-card-design-toolbar
        title: "Card design toolbar in design mode"
        kind: "frontend"
        dependsOn: [p4-design-mode-service, p2-card-component]
        details:
          - "In design mode, show toolbar on each card (border-radius slider, lock toggle, icon picker button, color picker button)."
          - "Integrate ngx-color-picker for background color selection."
          - "Update CardStyle and persist to backend."
        outputs:
          - "Per-card styling in design mode across tabs."

      - id: p4-resize-support
        title: "Card resize handles"
        kind: "frontend"
        dependsOn: [p2-board-layout-service]
        details:
          - "Add resize handles (directive or 3rd-party resizable) for cards in design mode."
          - "Integrate with BoardLayoutService to persist new w/h."
          - "Honor lock flags and permissions."
        outputs:
          - "Resizable cards per tab in design mode."

  - id: phase-5-icons-and-catalogs
    name: "Phase 5 – Service icons and catalog integrations"
    tasks:
      - id: p5-catalog-backend
        title: "Catalog aggregation backend"
        kind: "backend"
        dependsOn: [p1-backend-bootstrap]
        details:
          - "Create /api/catalog/popular and /api/catalog/icons?q= routes."
          - "Implement integrations with UnRAID/TrueNAS catalogs where feasible."
          - "Normalize to { id, name, source, iconUrl, tags } and cache responses."
        outputs:
          - "Unified icon catalog API."

      - id: p5-icon-picker-frontend
        title: "Icon picker UI in design mode"
        kind: "frontend"
        dependsOn: [p5-catalog-backend, p4-card-design-toolbar]
        details:
          - "Create dialog with search field and icon grid."
          - "Fetch from catalog endpoints."
          - "Allow custom icon upload linked to Card.icon.customUrl."
        outputs:
          - "Designers can assign icons to cards."

  - id: phase-6-authz-and-roles
    name: "Phase 6 – RBAC, permissions, and admin UI"
    tasks:
      - id: p6-permissions-model
        title: "Permission list and role mapping"
        kind: "backend"
        dependsOn: [p1-auth-jwt]
        details:
          - "Define permissions (board:view, board:edit, board:design, theme:edit, role:manage, user:manage, etc.)."
          - "Create Role entity and seed default roles (viewer, designer, admin)."
        outputs:
          - "Permission and role model in DB."

      - id: p6-backend-authz-middleware
        title: "Backend authorization middleware"
        kind: "backend"
        dependsOn: [p6-permissions-model]
        details:
          - "Middleware to check user permissions per route."
          - "Apply to boards, tabs, themes, roles, and user management routes."
        outputs:
          - "RBAC enforced on the API."

      - id: p6-frontend-permission-guard
        title: "Frontend permission guard and directive"
        kind: "frontend"
        dependsOn: [p6-permissions-model, p1-frontend-auth]
        details:
          - "Implement permission-based route guard (data.requiredPermissions)."
          - "Create *hasPermission directive for hiding UI actions."
        outputs:
          - "UI elements and routes gated by roles/permissions."

      - id: p6-admin-ui
        title: "Admin UI for users and roles"
        kind: "frontend"
        dependsOn: [p6-backend-authz-middleware]
        details:
          - "Create admin section for listing users and their roles."
          - "Add simple role assignment UI (admin-only)."
        outputs:
          - "Admin can manage who can design boards/tabs and who can only view."